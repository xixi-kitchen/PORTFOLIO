import{_ as ce}from"../@babel/@babel.34ca84e8.js";import{r as S}from"../react/react.f9fd670b.js";import{L as fe,T as Je,R as Qe,U as Ze,s as Le,B as et,M as tt,C as nt,a as rt,O as ot,P as it,S as Pe,b as ue,W as st,c as at,d as lt,e as ct,V as ft,f as ut,N as dt,A as pt,g as ee,h as vt,i as mt,j as ht,k as gt,l as Me,H as yt,D as _t,F as bt}from"../three/three.5251439a.js";import{u as wt}from"../react-use-measure/react-use-measure.d9096a57.js";import{F as Et,u as Ct}from"../its-fine/its-fine.8d310832.js";import{R as Pt,c as X}from"../react-reconciler/react-reconciler.202c2eca.js";import"../react-dom/react-dom.5d7c961a.js";import{G as Ee,D as Mt,M as de,O as St}from"../three-stdlib/three-stdlib.035b95a5.js";import{m as Ot}from"../react-merge-refs/react-merge-refs.239dbb3c.js";import{c as kt}from"../zustand/zustand.61e4068e.js";import{s as Tt,p as Rt,c as jt}from"../suspend-react/suspend-react.00b64780.js";var ae={},xt={get exports(){return ae},set exports(e){ae=e}},Ae={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(y,M){var P=y.length;y.push(M);e:for(;0<P;){var k=P-1>>>1,T=y[k];if(0<u(T,M))y[k]=M,y[P]=T,P=k;else break e}}function o(y){return y.length===0?null:y[0]}function i(y){if(y.length===0)return null;var M=y[0],P=y.pop();if(P!==M){y[0]=P;e:for(var k=0,T=y.length,B=T>>>1;k<B;){var D=2*(k+1)-1,K=y[D],N=D+1,re=y[N];if(0>u(K,P))N<T&&0>u(re,K)?(y[k]=re,y[N]=P,k=N):(y[k]=K,y[D]=P,k=D);else if(N<T&&0>u(re,P))y[k]=re,y[N]=P,k=N;else break e}}return M}function u(y,M){var P=y.sortIndex-M.sortIndex;return P!==0?P:y.id-M.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;e.unstable_now=function(){return v.now()}}else{var _=Date,h=_.now();e.unstable_now=function(){return _.now()-h}}var s=[],m=[],n=1,r=null,l=3,f=!1,d=!1,b=!1,p=typeof setTimeout=="function"?setTimeout:null,a=typeof clearTimeout=="function"?clearTimeout:null,c=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(y){for(var M=o(m);M!==null;){if(M.callback===null)i(m);else if(M.startTime<=y)i(m),M.sortIndex=M.expirationTime,t(s,M);else break;M=o(m)}}function w(y){if(b=!1,g(y),!d)if(o(s)!==null)d=!0,q(E);else{var M=o(m);M!==null&&z(w,M.startTime-y)}}function E(y,M){d=!1,b&&(b=!1,a(j),j=-1),f=!0;var P=l;try{for(g(M),r=o(s);r!==null&&(!(r.expirationTime>M)||y&&!C());){var k=r.callback;if(typeof k=="function"){r.callback=null,l=r.priorityLevel;var T=k(r.expirationTime<=M);M=e.unstable_now(),typeof T=="function"?r.callback=T:r===o(s)&&i(s),g(M)}else i(s);r=o(s)}if(r!==null)var B=!0;else{var D=o(m);D!==null&&z(w,D.startTime-M),B=!1}return B}finally{r=null,l=P,f=!1}}var O=!1,x=null,j=-1,F=5,L=-1;function C(){return!(e.unstable_now()-L<F)}function R(){if(x!==null){var y=e.unstable_now();L=y;var M=!0;try{M=x(!0,y)}finally{M?I():(O=!1,x=null)}}else O=!1}var I;if(typeof c=="function")I=function(){c(R)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,G=U.port2;U.port1.onmessage=R,I=function(){G.postMessage(null)}}else I=function(){p(R,0)};function q(y){x=y,O||(O=!0,I())}function z(y,M){j=p(function(){y(e.unstable_now())},M)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(y){y.callback=null},e.unstable_continueExecution=function(){d||f||(d=!0,q(E))},e.unstable_forceFrameRate=function(y){0>y||125<y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<y?Math.floor(1e3/y):5},e.unstable_getCurrentPriorityLevel=function(){return l},e.unstable_getFirstCallbackNode=function(){return o(s)},e.unstable_next=function(y){switch(l){case 1:case 2:case 3:var M=3;break;default:M=l}var P=l;l=M;try{return y()}finally{l=P}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(y,M){switch(y){case 1:case 2:case 3:case 4:case 5:break;default:y=3}var P=l;l=y;try{return M()}finally{l=P}},e.unstable_scheduleCallback=function(y,M,P){var k=e.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?k+P:k):P=k,y){case 1:var T=-1;break;case 2:T=250;break;case 5:T=1073741823;break;case 4:T=1e4;break;default:T=5e3}return T=P+T,y={id:n++,callback:M,priorityLevel:y,startTime:P,expirationTime:T,sortIndex:-1},P>k?(y.sortIndex=P,t(m,y),o(s)===null&&y===o(m)&&(b?(a(j),j=-1):b=!0,z(w,P-k))):(y.sortIndex=T,t(s,y),d||f||(d=!0,q(E))),y},e.unstable_shouldYield=C,e.unstable_wrapCallback=function(y){var M=l;return function(){var P=l;l=M;try{return y.apply(this,arguments)}finally{l=P}}}})(Ae);(function(e){e.exports=Ae})(xt);const Ce={},Lt=e=>void Object.assign(Ce,e);function At(e,t){function o(n,{args:r=[],attach:l,...f},d){let b=`${n[0].toUpperCase()}${n.slice(1)}`,p;if(n==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const a=f.object;p=W(a,{type:n,root:d,attach:l,primitive:!0})}else{const a=Ce[b];if(!a)throw new Error(`R3F: ${b} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");p=W(new a(...r),{type:n,root:d,attach:l,memoizedProps:{args:r}})}return p.__r3f.attach===void 0&&(p instanceof et?p.__r3f.attach="geometry":p instanceof tt&&(p.__r3f.attach="material")),b!=="inject"&&ve(p,f),p}function i(n,r){let l=!1;if(r){var f,d;(f=r.__r3f)!=null&&f.attach?pe(n,r,r.__r3f.attach):r.isObject3D&&n.isObject3D&&(n.add(r),l=!0),l||(d=n.__r3f)==null||d.objects.push(r),r.__r3f||W(r,{}),r.__r3f.parent=n,we(r),V(r)}}function u(n,r,l){let f=!1;if(r){var d,b;if((d=r.__r3f)!=null&&d.attach)pe(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){r.parent=n,r.dispatchEvent({type:"added"});const p=n.children.filter(c=>c!==r),a=p.indexOf(l);n.children=[...p.slice(0,a),r,...p.slice(a)],f=!0}f||(b=n.__r3f)==null||b.objects.push(r),r.__r3f||W(r,{}),r.__r3f.parent=n,we(r),V(r)}}function v(n,r,l=!1){n&&[...n].forEach(f=>_(r,f,l))}function _(n,r,l){if(r){var f,d,b;if(r.__r3f&&(r.__r3f.parent=null),(f=n.__r3f)!=null&&f.objects&&(n.__r3f.objects=n.__r3f.objects.filter(w=>w!==r)),(d=r.__r3f)!=null&&d.attach)Re(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){var p;n.remove(r),(p=r.__r3f)!=null&&p.root&&qt(r.__r3f.root,r)}const c=(b=r.__r3f)==null?void 0:b.primitive,g=l===void 0?r.dispose!==null&&!c:l;if(!c){var a;v((a=r.__r3f)==null?void 0:a.objects,r,g),v(r.children,r,g)}r.__r3f&&(delete r.__r3f.root,delete r.__r3f.objects,delete r.__r3f.handlers,delete r.__r3f.memoizedProps,c||delete r.__r3f),g&&r.dispose&&r.type!=="Scene"&&ae.unstable_scheduleCallback(ae.unstable_IdlePriority,()=>{try{r.dispose()}catch{}}),V(n)}}function h(n,r,l,f){var d;const b=(d=n.__r3f)==null?void 0:d.parent;if(!b)return;const p=o(r,l,n.__r3f.root);if(n.children){for(const a of n.children)a.__r3f&&i(p,a);n.children=n.children.filter(a=>!a.__r3f)}n.__r3f.objects.forEach(a=>i(p,a)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||_(b,n),p.parent&&(p.__r3f.autoRemovedBeforeAppend=!0),i(b,p),p.raycast&&p.__r3f.eventCount&&p.__r3f.root.getState().internal.interaction.push(p),[f,f.alternate].forEach(a=>{a!==null&&(a.stateNode=p,a.ref&&(typeof a.ref=="function"?a.ref(p):a.ref.current=p))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Pt({createInstance:o,removeChild:_,appendChild:i,appendInitialChild:i,insertBefore:u,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,r)=>{if(!r)return;const l=n.getState().scene;l.__r3f&&(l.__r3f.root=n,i(l,r))},removeChildFromContainer:(n,r)=>{r&&_(n.getState().scene,r)},insertInContainerBefore:(n,r,l)=>{if(!r||!l)return;const f=n.getState().scene;f.__r3f&&u(f,r,l)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var r;return!!((r=n==null?void 0:n.__r3f)!=null?r:{}).handlers},prepareUpdate(n,r,l,f){if(n.__r3f.primitive&&f.object&&f.object!==n)return[!0];{const{args:d=[],children:b,...p}=f,{args:a=[],children:c,...g}=l;if(!Array.isArray(d))throw new Error("R3F: the args prop must be an array!");if(d.some((E,O)=>E!==a[O]))return[!0];const w=Ne(n,p,g,!0);return w.changes.length?[!1,w]:null}},commitUpdate(n,[r,l],f,d,b,p){r?h(n,f,b,p):ve(n,l)},commitMount(n,r,l,f){var d;const b=(d=n.__r3f)!=null?d:{};n.raycast&&b.handlers&&b.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>W(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var r;const{attach:l,parent:f}=(r=n.__r3f)!=null?r:{};l&&f&&Re(f,n,l),n.isObject3D&&(n.visible=!1),V(n)},unhideInstance(n,r){var l;const{attach:f,parent:d}=(l=n.__r3f)!=null?l:{};f&&d&&pe(d,n,f),(n.isObject3D&&r.visible==null||r.visible)&&(n.visible=!0),V(n)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():X.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&A.fun(performance.now)?performance.now:A.fun(Date.now)?Date.now:()=>0,scheduleTimeout:A.fun(setTimeout)?setTimeout:void 0,cancelTimeout:A.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ve}}var Se,Oe;const De=()=>{var e;return(e=Ce.ColorManagement)!=null?e:null},Fe=e=>e&&e.isOrthographicCamera,Dt=e=>e&&e.hasOwnProperty("current"),te=typeof window<"u"&&((Se=window.document)!=null&&Se.createElement||((Oe=window.navigator)==null?void 0:Oe.product)==="ReactNative")?S.useLayoutEffect:S.useEffect;function Ie(e){const t=S.useRef(e);return te(()=>void(t.current=e),[e]),t}function Ft({set:e}){return te(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ze extends S.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}ze.getDerivedStateFromError=()=>({error:!0});const He="__default",ke=new Map,It=e=>e&&!!e.memoized&&!!e.changes;function Be(e){const t=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(e)?Math.min(Math.max(e[0],t),e[1]):e}const J=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},A={obj:e=>e===Object(e)&&!A.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:u=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(A.str(e)||A.num(e))return e===t;const v=A.obj(e);if(v&&i==="reference")return e===t;const _=A.arr(e);if(_&&o==="reference")return e===t;if((_||v)&&e===t)return!0;let h;for(h in e)if(!(h in t))return!1;if(v&&o==="shallow"&&i==="shallow"){for(h in u?t:e)if(!A.equ(e[h],t[h],{strict:u,objects:"reference"}))return!1}else for(h in u?t:e)if(e[h]!==t[h])return!1;if(A.und(h)){if(_&&e.length===0&&t.length===0||v&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function zt(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function Ht(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function W(e,t){const o=e;return(t!=null&&t.primitive||!o.__r3f)&&(o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function be(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),u=i.pop();return o=i.reduce((v,_)=>v[_],e),{target:o,key:u}}else return{target:o,key:t}}const Te=/-\d+$/;function pe(e,t,o){if(A.str(o)){if(Te.test(o)){const v=o.replace(Te,""),{target:_,key:h}=be(e,v);Array.isArray(_[h])||(_[h]=[])}const{target:i,key:u}=be(e,o);t.__r3f.previousAttach=i[u],i[u]=t}else t.__r3f.previousAttach=o(e,t)}function Re(e,t,o){var i,u;if(A.str(o)){const{target:v,key:_}=be(e,o),h=t.__r3f.previousAttach;h===void 0?delete v[_]:v[_]=h}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(u=t.__r3f)==null||delete u.previousAttach}function Ne(e,{children:t,key:o,ref:i,...u},{children:v,key:_,ref:h,...s}={},m=!1){var n;const r=(n=e==null?void 0:e.__r3f)!=null?n:{},l=Object.entries(u),f=[];if(m){const b=Object.keys(s);for(let p=0;p<b.length;p++)u.hasOwnProperty(b[p])||l.unshift([b[p],He+"remove"])}l.forEach(([b,p])=>{var a;if((a=e.__r3f)!=null&&a.primitive&&b==="object"||A.equ(p,s[b]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(b))return f.push([b,p,!0,[]]);let c=[];b.includes("-")&&(c=b.split("-")),f.push([b,p,!1,c]);for(const g in u){const w=u[g];g.startsWith(`${b}-`)&&f.push([g,w,!1,g.split("-")])}});const d={...u};return r.memoizedProps&&r.memoizedProps.args&&(d.args=r.memoizedProps.args),r.memoizedProps&&r.memoizedProps.attach&&(d.attach=r.memoizedProps.attach),{memoized:d,changes:f}}function ve(e,t){var o,i,u;const v=(o=e.__r3f)!=null?o:{},_=v.root,h=(i=_==null||_.getState==null?void 0:_.getState())!=null?i:{},{memoized:s,changes:m}=It(t)?t:Ne(e,t),n=v.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let l=0;l<m.length;l++){let[f,d,b,p]=m[l],a=e,c=a[f];if(p.length&&(c=p.reduce((g,w)=>g[w],e),!(c&&c.set))){const[g,...w]=p.reverse();a=w.reverse().reduce((E,O)=>E[O],e),f=g}if(d===He+"remove")if(a.constructor){let g=ke.get(a.constructor);g||(g=new a.constructor,ke.set(a.constructor,g)),d=g[f]}else d=0;if(b)d?v.handlers[f]=d:delete v.handlers[f],v.eventCount=Object.keys(v.handlers).length;else if(c&&c.set&&(c.copy||c instanceof fe)){if(Array.isArray(d))c.fromArray?c.fromArray(d):c.set(...d);else if(c.copy&&d&&d.constructor&&c.constructor===d.constructor)c.copy(d);else if(d!==void 0){const g=c instanceof nt;!g&&c.setScalar?c.setScalar(d):c instanceof fe&&d instanceof fe?c.mask=d.mask:c.set(d),!De()&&!h.linear&&g&&c.convertSRGBToLinear()}}else a[f]=d,!h.linear&&a[f]instanceof Je&&a[f].format===Qe&&a[f].type===Ze&&(a[f].encoding=Le);V(e)}if(v.parent&&h.internal&&e.raycast&&n!==v.eventCount){const l=h.internal.interaction.indexOf(e);l>-1&&h.internal.interaction.splice(l,1),v.eventCount&&h.internal.interaction.push(e)}return!(m.length===1&&m[0][0]==="onUpdate")&&m.length&&(u=e.__r3f)!=null&&u.parent&&we(e),e}function V(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function we(e){e.onUpdate==null||e.onUpdate(e)}function Bt(e,t){e.manual||(Fe(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function oe(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Nt(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return X.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return X.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return X.ContinuousEventPriority;default:return X.DefaultEventPriority}}function qe(e,t,o,i){const u=o.get(t);u&&(o.delete(t),o.size===0&&(e.delete(i),u.target.releasePointerCapture(i)))}function qt(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,u)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(u)}),o.capturedMap.forEach((i,u)=>{qe(o.capturedMap,t,i,u)})}function Ut(e){function t(s){const{internal:m}=e.getState(),n=s.offsetX-m.initialClick[0],r=s.offsetY-m.initialClick[1];return Math.round(Math.sqrt(n*n+r*r))}function o(s){return s.filter(m=>["Move","Over","Enter","Out","Leave"].some(n=>{var r;return(r=m.__r3f)==null?void 0:r.handlers["onPointer"+n]}))}function i(s,m){const n=e.getState(),r=new Set,l=[],f=m?m(n.internal.interaction):n.internal.interaction;for(let a=0;a<f.length;a++){const c=J(f[a]);c&&(c.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(s,n);function d(a){const c=J(a);if(!c||!c.events.enabled||c.raycaster.camera===null)return[];if(c.raycaster.camera===void 0){var g;c.events.compute==null||c.events.compute(s,c,(g=c.previousRoot)==null?void 0:g.getState()),c.raycaster.camera===void 0&&(c.raycaster.camera=null)}return c.raycaster.camera?c.raycaster.intersectObject(a,!0):[]}let b=f.flatMap(d).sort((a,c)=>{const g=J(a.object),w=J(c.object);return!g||!w?a.distance-c.distance:w.events.priority-g.events.priority||a.distance-c.distance}).filter(a=>{const c=oe(a);return r.has(c)?!1:(r.add(c),!0)});n.events.filter&&(b=n.events.filter(b,n));for(const a of b){let c=a.object;for(;c;){var p;(p=c.__r3f)!=null&&p.eventCount&&l.push({...a,eventObject:c}),c=c.parent}}if("pointerId"in s&&n.internal.capturedMap.has(s.pointerId))for(let a of n.internal.capturedMap.get(s.pointerId).values())r.has(oe(a.intersection))||l.push(a.intersection);return l}function u(s,m,n,r){const l=e.getState();if(s.length){const f={stopped:!1};for(const d of s){const b=J(d.object)||l,{raycaster:p,pointer:a,camera:c,internal:g}=b,w=new ee(a.x,a.y,0).unproject(c),E=L=>{var C,R;return(C=(R=g.capturedMap.get(L))==null?void 0:R.has(d.eventObject))!=null?C:!1},O=L=>{const C={intersection:d,target:m.target};g.capturedMap.has(L)?g.capturedMap.get(L).set(d.eventObject,C):g.capturedMap.set(L,new Map([[d.eventObject,C]])),m.target.setPointerCapture(L)},x=L=>{const C=g.capturedMap.get(L);C&&qe(g.capturedMap,d.eventObject,C,L)};let j={};for(let L in m){let C=m[L];typeof C!="function"&&(j[L]=C)}let F={...d,...j,pointer:a,intersections:s,stopped:f.stopped,delta:n,unprojectedPoint:w,ray:p.ray,camera:c,stopPropagation(){const L="pointerId"in m&&g.capturedMap.get(m.pointerId);if((!L||L.has(d.eventObject))&&(F.stopped=f.stopped=!0,g.hovered.size&&Array.from(g.hovered.values()).find(C=>C.eventObject===d.eventObject))){const C=s.slice(0,s.indexOf(d));v([...C,d])}},target:{hasPointerCapture:E,setPointerCapture:O,releasePointerCapture:x},currentTarget:{hasPointerCapture:E,setPointerCapture:O,releasePointerCapture:x},nativeEvent:m};if(r(F),f.stopped===!0)break}}return s}function v(s){const{internal:m}=e.getState();for(const n of m.hovered.values())if(!s.length||!s.find(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const l=n.eventObject.__r3f,f=l==null?void 0:l.handlers;if(m.hovered.delete(oe(n)),l!=null&&l.eventCount){const d={...n,intersections:s};f.onPointerOut==null||f.onPointerOut(d),f.onPointerLeave==null||f.onPointerLeave(d)}}}function _(s,m){for(let n=0;n<m.length;n++){const r=m[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(s)}}function h(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>v([]);case"onLostPointerCapture":return m=>{const{internal:n}=e.getState();"pointerId"in m&&n.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(m.pointerId)&&(n.capturedMap.delete(m.pointerId),v([]))})}}return function(n){const{onPointerMissed:r,internal:l}=e.getState();l.lastEvent.current=n;const f=s==="onPointerMove",d=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",p=i(n,f?o:void 0),a=d?t(n):0;s==="onPointerDown"&&(l.initialClick=[n.offsetX,n.offsetY],l.initialHits=p.map(g=>g.eventObject)),d&&!p.length&&a<=2&&(_(n,l.interaction),r&&r(n)),f&&v(p);function c(g){const w=g.eventObject,E=w.__r3f,O=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(f){if(O.onPointerOver||O.onPointerEnter||O.onPointerOut||O.onPointerLeave){const x=oe(g),j=l.hovered.get(x);j?j.stopped&&g.stopPropagation():(l.hovered.set(x,g),O.onPointerOver==null||O.onPointerOver(g),O.onPointerEnter==null||O.onPointerEnter(g))}O.onPointerMove==null||O.onPointerMove(g)}else{const x=O[s];x?(!d||l.initialHits.includes(w))&&(_(n,l.interaction.filter(j=>!l.initialHits.includes(j))),x(g)):d&&l.initialHits.includes(w)&&_(n,l.interaction.filter(j=>!l.initialHits.includes(j)))}}u(p,n,a,c)}}return{handlePointer:h}}const Ue=e=>!!(e!=null&&e.render),Ge=S.createContext(null),Gt=(e,t)=>{const o=kt((h,s)=>{const m=new ee,n=new ee,r=new ee;function l(a=s().camera,c=n,g=s().size){const{width:w,height:E,top:O,left:x}=g,j=w/E;c instanceof ee?r.copy(c):r.set(...c);const F=a.getWorldPosition(m).distanceTo(r);if(Fe(a))return{width:w/a.zoom,height:E/a.zoom,top:O,left:x,factor:1,distance:F,aspect:j};{const L=a.fov*Math.PI/180,C=2*Math.tan(L/2)*F,R=C*(w/E);return{width:R,height:C,top:O,left:x,factor:w/R,distance:F,aspect:j}}}let f;const d=a=>h(c=>({performance:{...c.performance,current:a}})),b=new vt;return{set:h,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(a=1)=>e(s(),a),advance:(a,c)=>t(a,c,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new mt,pointer:b,mouse:b,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const a=s();f&&clearTimeout(f),a.performance.current!==a.performance.min&&d(a.performance.min),f=setTimeout(()=>d(s().performance.max),a.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:a=>h(c=>({...c,events:{...c.events,...a}})),setSize:(a,c,g,w,E)=>{const O=s().camera,x={width:a,height:c,top:w||0,left:E||0,updateStyle:g};h(j=>({size:x,viewport:{...j.viewport,...l(O,n,x)}}))},setDpr:a=>h(c=>{const g=Be(a);return{viewport:{...c.viewport,dpr:g,initialDpr:c.viewport.initialDpr||g}}}),setFrameloop:(a="always")=>{const c=s().clock;c.stop(),c.elapsedTime=0,a!=="never"&&(c.start(),c.elapsedTime=0),h(()=>({frameloop:a}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:S.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(a,c,g)=>{const w=s().internal;return w.priority=w.priority+(c>0?1:0),w.subscribers.push({ref:a,priority:c,store:g}),w.subscribers=w.subscribers.sort((E,O)=>E.priority-O.priority),()=>{const E=s().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(c>0?1:0),E.subscribers=E.subscribers.filter(O=>O.ref!==a))}}}}}),i=o.getState();let u=i.size,v=i.viewport.dpr,_=i.camera;return o.subscribe(()=>{const{camera:h,size:s,viewport:m,gl:n,set:r}=o.getState();if(s!==u||m.dpr!==v){var l;u=s,v=m.dpr,Bt(h,s),n.setPixelRatio(m.dpr);const f=(l=s.updateStyle)!=null?l:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(s.width,s.height,f)}h!==_&&(_=h,r(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(h)}})))}),o.subscribe(h=>e(h)),o};let ie,$t=new Set,Wt=new Set,Vt=new Set;function me(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function Q(e,t){switch(e){case"before":return me($t,t);case"after":return me(Wt,t);case"tail":return me(Vt,t)}}let he,ge;function ye(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),he=t.internal.subscribers,ie=0;ie<he.length;ie++)ge=he[ie],ge.ref.current(ge.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Xt(e){let t=!1,o,i,u;function v(s){i=requestAnimationFrame(v),t=!0,o=0,Q("before",s);for(const n of e.values()){var m;u=n.store.getState(),u.internal.active&&(u.frameloop==="always"||u.internal.frames>0)&&!((m=u.gl.xr)!=null&&m.isPresenting)&&(o+=ye(s,u))}if(Q("after",s),o===0)return Q("tail",s),t=!1,cancelAnimationFrame(i)}function _(s,m=1){var n;if(!s)return e.forEach(r=>_(r.store.getState()),m);(n=s.gl.xr)!=null&&n.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+m),t||(t=!0,requestAnimationFrame(v)))}function h(s,m=!0,n,r){if(m&&Q("before",s),n)ye(s,n,r);else for(const l of e.values())ye(s,l.store.getState());m&&Q("after",s)}return{loop:v,invalidate:_,advance:h}}function $e(){const e=S.useContext(Ge);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function H(e=o=>o,t){return $e()(e,t)}function We(e,t=0){const o=$e(),i=o.getState().internal.subscribe,u=Ie(e);return te(()=>i(u,t,o),[t,i,o]),null}function Ve(e,t){return function(o,...i){const u=new o;return e&&e(u),Promise.all(i.map(v=>new Promise((_,h)=>u.load(v,s=>{s.scene&&Object.assign(s,zt(s.scene)),_(s)},t,s=>h(new Error(`Could not load ${v}: ${s.message})`))))))}}function ne(e,t,o,i){const u=Array.isArray(t)?t:[t],v=Tt(Ve(o,i),[e,...u],{equal:A.equ});return Array.isArray(t)?v:v[0]}ne.preload=function(e,t,o){const i=Array.isArray(t)?t:[t];return Rt(Ve(o),[e,...i])};ne.clear=function(e,t){const o=Array.isArray(t)?t:[t];return jt([e,...o])};const Y=new Map,{invalidate:je,advance:xe}=Xt(Y),{reconciler:le,applyProps:Z}=At(Y,Nt),$={objects:"shallow",strict:!1},Yt=(e,t)=>{const o=typeof e=="function"?e(t):e;return Ue(o)?o:new st({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Kt(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:i,top:u,left:v}=e.parentElement.getBoundingClientRect();return{width:o,height:i,top:u,left:v}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Jt(e){const t=Y.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const u=typeof reportError=="function"?reportError:console.error,v=i||Gt(je,xe),_=o||le.createContainer(v,X.ConcurrentRoot,null,!1,null,"",u,null);t||Y.set(e,{fiber:_,store:v});let h,s=!1,m;return{configure(n={}){let{gl:r,size:l,scene:f,events:d,onCreated:b,shadows:p=!1,linear:a=!1,flat:c=!1,legacy:g=!1,orthographic:w=!1,frameloop:E="always",dpr:O=[1,2],performance:x,raycaster:j,camera:F,onPointerMissed:L}=n,C=v.getState(),R=C.gl;C.gl||C.set({gl:R=Yt(r,e)});let I=C.raycaster;I||C.set({raycaster:I=new rt});const{params:U,...G}=j||{};if(A.equ(G,I,$)||Z(I,{...G}),A.equ(U,I.params,$)||Z(I,{params:{...I.params,...U}}),!C.camera||C.camera===m&&!A.equ(m,F,$)){m=F;const k=F instanceof at,T=k?F:w?new ot(0,0,0,0,.1,1e3):new it(75,0,.1,1e3);k||(T.position.z=5,F&&Z(T,F),!C.camera&&!(F!=null&&F.rotation)&&T.lookAt(0,0,0)),C.set({camera:T})}if(!C.scene){let k;f instanceof Pe?k=f:(k=new Pe,f&&Z(k,f)),C.set({scene:W(k)})}if(!C.xr){const k=(D,K)=>{const N=v.getState();N.frameloop!=="never"&&xe(D,!0,N,K)},T=()=>{const D=v.getState();D.gl.xr.enabled=D.gl.xr.isPresenting,D.gl.xr.setAnimationLoop(D.gl.xr.isPresenting?k:null),D.gl.xr.isPresenting||je(D)},B={connect(){const D=v.getState().gl;D.xr.addEventListener("sessionstart",T),D.xr.addEventListener("sessionend",T)},disconnect(){const D=v.getState().gl;D.xr.removeEventListener("sessionstart",T),D.xr.removeEventListener("sessionend",T)}};R.xr&&B.connect(),C.set({xr:B})}if(R.shadowMap){const k=R.shadowMap.enabled,T=R.shadowMap.type;if(R.shadowMap.enabled=!!p,A.boo(p))R.shadowMap.type=ue;else if(A.str(p)){var q;const B={basic:lt,percentage:ct,soft:ue,variance:ft};R.shadowMap.type=(q=B[p])!=null?q:ue}else A.obj(p)&&Object.assign(R.shadowMap,p);(k!==R.shadowMap.enabled||T!==R.shadowMap.type)&&(R.shadowMap.needsUpdate=!0)}const z=De();z&&("enabled"in z?z.enabled=!g:"legacyMode"in z&&(z.legacyMode=g));const y=a?ut:Le,M=c?dt:pt;R.outputEncoding!==y&&(R.outputEncoding=y),R.toneMapping!==M&&(R.toneMapping=M),C.legacy!==g&&C.set(()=>({legacy:g})),C.linear!==a&&C.set(()=>({linear:a})),C.flat!==c&&C.set(()=>({flat:c})),r&&!A.fun(r)&&!Ue(r)&&!A.equ(r,R,$)&&Z(R,r),d&&!C.events.handlers&&C.set({events:d(v)});const P=Kt(e,l);return A.equ(P,C.size,$)||C.setSize(P.width,P.height,P.updateStyle,P.top,P.left),O&&C.viewport.dpr!==Be(O)&&C.setDpr(O),C.frameloop!==E&&C.setFrameloop(E),C.onPointerMissed||C.set({onPointerMissed:L}),x&&!A.equ(x,C.performance,$)&&C.set(k=>({performance:{...k.performance,...x}})),h=b,s=!0,this},render(n){return s||this.configure(),le.updateContainer(S.createElement(Qt,{store:v,children:n,onCreated:h,rootElement:e}),_,null,()=>{}),v},unmount(){Xe(e)}}}function Qt({store:e,children:t,onCreated:o,rootElement:i}){return te(()=>{const u=e.getState();u.set(v=>({internal:{...v.internal,active:!0}})),o&&o(u),e.getState().events.connected||u.events.connect==null||u.events.connect(i)},[]),S.createElement(Ge.Provider,{value:e},t)}function Xe(e,t){const o=Y.get(e),i=o==null?void 0:o.fiber;if(i){const u=o==null?void 0:o.store.getState();u&&(u.internal.active=!1),le.updateContainer(null,i,null,()=>{u&&setTimeout(()=>{try{var v,_,h,s;u.events.disconnect==null||u.events.disconnect(),(v=u.gl)==null||(_=v.renderLists)==null||_.dispose==null||_.dispose(),(h=u.gl)==null||h.forceContextLoss==null||h.forceContextLoss(),(s=u.gl)!=null&&s.xr&&u.xr.disconnect(),Ht(u),Y.delete(e),t&&t(e)}catch{}},500)})}}le.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:S.version});const _e={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Zt(e){const{handlePointer:t}=Ut(e);return{priority:1,enabled:!0,compute(o,i,u){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(_e).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:u}=e.getState();(o=u.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(u.lastEvent.current)},connect:o=>{var i;const{set:u,events:v}=e.getState();v.disconnect==null||v.disconnect(),u(_=>({events:{..._.events,connected:o}})),Object.entries((i=v.handlers)!=null?i:[]).forEach(([_,h])=>{const[s,m]=_e[_];o.addEventListener(s,h,{passive:m})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var u;Object.entries((u=i.handlers)!=null?u:[]).forEach(([v,_])=>{if(i&&i.connected instanceof HTMLElement){const[h]=_e[v];i.connected.removeEventListener(h,_)}}),o(v=>({events:{...v.events,connected:void 0}}))}}}}const en=S.forwardRef(function({children:t,fallback:o,resize:i,style:u,gl:v,events:_=Zt,eventSource:h,eventPrefix:s,shadows:m,linear:n,flat:r,legacy:l,orthographic:f,frameloop:d,dpr:b,performance:p,raycaster:a,camera:c,onPointerMissed:g,onCreated:w,...E},O){S.useMemo(()=>Lt(ht),[]);const x=Ct(),[j,F]=wt({scroll:!0,debounce:{scroll:50,resize:0},...i}),L=S.useRef(null),C=S.useRef(null);S.useImperativeHandle(O,()=>L.current);const R=Ie(g),[I,U]=S.useState(!1),[G,q]=S.useState(!1);if(I)throw I;if(G)throw G;const z=S.useRef(null);te(()=>{const M=L.current;F.width>0&&F.height>0&&M&&(z.current||(z.current=Jt(M)),z.current.configure({gl:v,events:_,shadows:m,linear:n,flat:r,legacy:l,orthographic:f,frameloop:d,dpr:b,performance:p,raycaster:a,camera:c,size:F,onPointerMissed:(...P)=>R.current==null?void 0:R.current(...P),onCreated:P=>{P.events.connect==null||P.events.connect(h?Dt(h)?h.current:h:C.current),s&&P.setEvents({compute:(k,T)=>{const B=k[s+"X"],D=k[s+"Y"];T.pointer.set(B/T.size.width*2-1,-(D/T.size.height)*2+1),T.raycaster.setFromCamera(T.pointer,T.camera)}}),w==null||w(P)}}),z.current.render(S.createElement(x,null,S.createElement(ze,{set:q},S.createElement(S.Suspense,{fallback:S.createElement(Ft,{set:U})},t)))))}),S.useEffect(()=>{const M=L.current;if(M)return()=>Xe(M)},[]);const y=h?"none":"auto";return S.createElement("div",ce({ref:C,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:y,...u}},E),S.createElement("div",{ref:j,style:{width:"100%",height:"100%"}},S.createElement("canvas",{ref:L,style:{display:"block"}},o)))}),mn=S.forwardRef(function(t,o){return S.createElement(Et,null,S.createElement(en,ce({},t,{ref:o})))});let se=null;function Ye(e,t,o){return i=>{o&&o(i),e&&(se||(se=new Mt),se.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(se)),t&&i.setMeshoptDecoder(typeof de=="function"?de():de)}}function Ke(e,t=!0,o=!0,i){return ne(Ee,e,Ye(t,o,i))}Ke.preload=(e,t=!0,o=!0,i)=>ne.preload(Ee,e,Ye(t,o,i));Ke.clear=e=>ne.clear(Ee,e);function tn(e,t,o){const{gl:i,size:u,viewport:v}=H(),_=typeof e=="number"?e:u.width*v.dpr,h=typeof t=="number"?t:u.height*v.dpr,s=(typeof e=="number"?o:e)||{},{samples:m=0,depth:n,...r}=s,l=S.useMemo(()=>{let f;return f=new gt(_,h,{minFilter:Me,magFilter:Me,encoding:i.outputEncoding,type:yt,...r}),n&&(f.depthTexture=new _t(_,h,bt)),f.samples=m,f},[]);return S.useLayoutEffect(()=>{l.setSize(_,h),m&&(l.samples=m)},[m,l,_,h]),S.useEffect(()=>()=>l.dispose(),[]),l}const nn=e=>typeof e=="function",hn=S.forwardRef(({envMap:e,resolution:t=256,frames:o=1/0,makeDefault:i,children:u,...v},_)=>{const h=H(({set:p})=>p),s=H(({camera:p})=>p),m=H(({size:p})=>p),n=S.useRef(null),r=S.useRef(null),l=tn(t);S.useLayoutEffect(()=>{v.manual||(n.current.aspect=m.width/m.height)},[m,v]),S.useLayoutEffect(()=>{n.current.updateProjectionMatrix()});let f=0,d=null;const b=nn(u);return We(p=>{b&&(o===1/0||f<o)&&(r.current.visible=!1,p.gl.setRenderTarget(l),d=p.scene.background,e&&(p.scene.background=e),p.gl.render(p.scene,n.current),p.scene.background=d,p.gl.setRenderTarget(null),r.current.visible=!0,f++)}),S.useLayoutEffect(()=>{if(i){const p=s;return h(()=>({camera:n.current})),()=>h(()=>({camera:p}))}},[n,i,h]),S.createElement(S.Fragment,null,S.createElement("perspectiveCamera",ce({ref:Ot([n,_])},v),!b&&u),S.createElement("group",{ref:r},b&&u(l.texture)))}),gn=S.forwardRef(({makeDefault:e,camera:t,regress:o,domElement:i,enableDamping:u=!0,onChange:v,onStart:_,onEnd:h,...s},m)=>{const n=H(E=>E.invalidate),r=H(E=>E.camera),l=H(E=>E.gl),f=H(E=>E.events),d=H(E=>E.setEvents),b=H(E=>E.set),p=H(E=>E.get),a=H(E=>E.performance),c=t||r,g=i||f.connected||l.domElement,w=S.useMemo(()=>new St(c),[c]);return We(()=>{w.enabled&&w.update()},-1),S.useEffect(()=>(w.connect(g),()=>void w.dispose()),[g,o,w,n]),S.useEffect(()=>{const E=j=>{n(),o&&a.regress(),v&&v(j)},O=j=>{_&&_(j)},x=j=>{h&&h(j)};return w.addEventListener("change",E),w.addEventListener("start",O),w.addEventListener("end",x),()=>{w.removeEventListener("start",O),w.removeEventListener("end",x),w.removeEventListener("change",E)}},[v,_,h,w,n,d]),S.useEffect(()=>{if(e){const E=p().controls;return b({controls:w}),()=>b({controls:E})}},[e,w]),S.createElement("primitive",ce({ref:m,object:w,enableDamping:u},s))});export{mn as C,gn as O,hn as P,Ke as u};
